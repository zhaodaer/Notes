#### 编写步骤

① 确定主设备号，也可以让内核分配

② 定义自己的 file_operations 结构体

③ 实现对应的 drv_open/ drv_read/ drv_write 等函数，填入 file_operations 结构体

④ 把 file_operations 结构体告诉内核：register_chrdev

⑤ 谁来注册驱动程序？得有一个入口函数：安装驱动程序时，就会去调用这个入口函数

⑥ 有入口函数就应该有出口函数：卸载驱动程序时，出口函数调用 unregister_chrdev

⑦ 其他完善：提供设备信息，自动创建设备节点：class_create, device_create





#### 文件句柄

文件句柄是一个抽象的概念，它用于在编程中表示对特定文件的访问。在许多编程语言中，当你打开一个文件以进行读取、写入或其他操作时，你会被分配一个文件句柄。这个文件句柄就像一个钥匙，允许你通过它来访问和操作文件。

文件句柄的本质是一个整数或一个代表特定文件打开实例的标识符。当你打开一个文件时，操作系统会为该文件返回一个唯一的文件句柄。你可以使用这个文件句柄来读取或写入文件，甚至可以在程序的不同部分之间传递它，以便对同一个文件进行共享访问。

文件句柄在处理文件I/O（输入/输出）时非常重要。通过文件句柄，你可以有效地控制对文件的访问，例如掌握读取或写入数据的速度，或者在不同的线程之间协调对同一个文件的访问。在某些情况下，当需要对大量数据进行处理时，文件句柄也用于缓存数据的读取和写入，以提高程序的性能。

需要注意的是，一旦关闭了与文件句柄关联的文件，该文件句柄就会失效，不能再用于访问该文件。再次访问该文件需要重新打开并获取新的文件句柄。